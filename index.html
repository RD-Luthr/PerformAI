<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerformAI Search Dashboard</title>
    <link rel="icon" type="image/x-icon" href="Clean P Logo icon small.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #1a4a5c 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            overscroll-behavior: none; /* disables scroll bounce */
            margin: 0;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0D313E 0%, #1a4a5c 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .back-arrow {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-arrow:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-50%) translateX(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .back-arrow svg {
            width: 24px;
            height: 24px;
            fill: white;
            transition: transform 0.3s ease;
        }

        .back-arrow:hover svg {
            transform: translateX(-2px);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            transition: grid-template-columns 0.5s ease;
        }

        .main-content.results-visible {
            grid-template-columns: 1fr 2fr;
        }

        .search-panel {
            background: #BFF0EC;
            padding: 40px;
            border-right: 1px solid #a8e6e1;
            position: relative;
        }

        .search-panel-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(191, 240, 236, 0.95);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 0;
        }

        .search-panel-loading .loading-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(178, 150, 71, 0.2);
        }

        .search-panel-loading .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #B29647;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .search-panel-loading h4 {
            color: #0D313E;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .search-panel-loading p {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .results-panel {
            padding: 40px;
            background: white;
            display: flex;
            flex-direction: column;
            max-height: 950px;
            overflow: hidden;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: #0D313E;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .form-section h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #B29647, #d4b564);
            margin-right: 10px;
            border-radius: 2px;
        }

        .form-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .upload-label {
            background: rgba(178, 150, 71, 0.1);
            border: 1px solid #B29647;
            color: #B29647;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            height: 38px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .upload-label:hover {
            background: #B29647;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(178, 150, 71, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #0D313E;
            font-size: 0.9rem;
        }

        input, textarea, select {
            font-family: 'Manrope', sans-serif;
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #a8e6e1;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #B29647;
            box-shadow: 0 0 0 3px rgba(178, 150, 71, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .search-btn {
            font-family: 'Manrope', sans-serif;
            width: 100%;
            background: linear-gradient(135deg, #B29647 0%, #d4b564 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(178, 150, 71, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .results-header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Commented out - Save to Google Sheets button styles
        .save-to-sheets-btn {
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            gap: 6px;
            height: 38px;
            background: rgba(203, 240, 191, 0.3);
            color: #0F9D58;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid #BFF0EC;
        }

        .save-to-sheets-btn:hover {
            background: rgba(128, 239, 90, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 168, 83, 0.3);
        }

        .save-to-sheets-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        */

        .google-sheets-icon {
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            justify-content: center;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: rgba(52, 168, 83, 0.1);
            border: 1px solid rgba(52, 168, 83, 0.2);
        }

        .google-sheets-icon:hover {
            background: rgba(52, 168, 83, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 168, 83, 0.3);
        }

        .google-sheets-icon img {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .google-sheets-icon:hover img {
            transform: scale(1.1);
        }

        .results-header h3 {
            color: #0D313E;
            font-size: 1.4rem;
        }

        .results-count {
            background: rgba(191, 240, 236, 0.3);
            color: #0D313E;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid #BFF0EC;
        }

        .results-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .results-per-page {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .results-per-page select {
            width: auto;
            padding: 8px 12px;
            border: 1px solid #BFF0EC;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .view-toggle {
            display: flex;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #BFF0EC;
        }

        .view-toggle button {
            padding: 8px 16px;
            border: none;
            background: white;
            color: #0D313E;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: #B29647;
            color: white;
        }

        .results-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-right: -10px;
        }

        .results-container::-webkit-scrollbar {
            width: 6px;
        }

        .results-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .results-container::-webkit-scrollbar-thumb {
            background: #BFF0EC;
            border-radius: 3px;
        }

        .results-container::-webkit-scrollbar-thumb:hover {
            background: #B29647;
        }

        .results-grid {
            display: grid;
            gap: 15px;
        }

        .results-grid.compact {
            grid-template-columns: 1fr;
        }

        .results-grid.cards {
            grid-template-columns: 1fr;
        }

        .candidate-card {
            background: white;
            border: 2px solid #BFF0EC;
            border-radius: 15px;
            padding: 25px;
            padding-top: 20px;
            padding-bottom: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .candidate-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #B29647, #d4b564);
        }

        .candidate-card:hover {
            border-color: #B29647;
            box-shadow: 0 8px 25px rgba(178, 150, 71, 0.15);
            transform: translateY(-2px);
        }

        .learn-more-btn {
            background: rgba(178, 150, 71, 0.1);
            border: 1px solid #B29647;
            color: #B29647;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .learn-more-btn:hover {
            background: #B29647;
            color: white;
            transform: translateY(-1px);
        }

        .learn-more-btn .arrow {
            transition: transform 0.3s ease;
            font-size: 0.7rem;
        }

        .learn-more-btn.expanded .arrow {
            transform: rotate(180deg);
        }

        .candidate-reason {
            margin-top: 15px;
            padding: 15px;
            background: rgba(191, 240, 236, 0.1);
            border-radius: 10px;
            border-left: 3px solid #B29647;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .candidate-reason.visible {
            display: block;
        }

        .candidate-reason h5 {
            color: #0D313E;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .candidate-reason p {
            color: #6c757d;
            font-size: 0.85rem;
            line-height: 1.4;
            margin: 0;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
                padding-top: 15px;
                padding-bottom: 15px;
            }
        }

        .candidate-card.compact {
            padding: 15px;
            margin-bottom: 0;
        }

        .candidate-card.compact .candidate-name {
            font-size: 1.1rem;
            margin-bottom: 3px;
        }

        .candidate-card.compact .candidate-title {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .candidate-card.compact .candidate-info {
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .candidate-card.compact .info-item {
            font-size: 0.8rem;
        }

        .candidate-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .candidate-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #0D313E;
            margin-bottom: 5px;
        }

        .candidate-title {
            color: #6c757d;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .candidate-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .info-label {
            font-weight: 600;
            color: #0D313E;
            margin-right: 8px;
        }

        .info-value {
            color: #6c757d;
        }

        .skills-container {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            flex-wrap: wrap;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .skill-pill {
            background-color: #f0f0f0;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
            white-space: nowrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save {
            background: #B29647;
            color: white;
        }

        .btn-save:hover {
            background: #9a7f3b;
            transform: translateY(-1px);
        }

        .btn-view {
            background: #0077B5;
            color: white;
        }

        .btn-view:hover {
            background: #0a2530;
            transform: translateY(-1px);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px 0;
            border-top: 1px solid #BFF0EC;
            flex-shrink: 0;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #BFF0EC;
            background: white;
            color: #0D313E;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .pagination button:hover:not(:disabled) {
            background: #BFF0EC;
        }

        .pagination button.active {
            background: #B29647;
            color: white;
            border-color: #B29647;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            color: #6c757d;
            font-size: 0.9rem;
            margin: 0 15px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #495057;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .candidate-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .candidate-rank {
            font-weight: bold;
            font-size: 14px;
            color: #6c757d;
            margin-left: auto;
        }


        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 49, 62, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.6s ease;
        }

        .welcome-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .welcome-content {
            text-align: center;
            color: white;
            max-width: 600px;
            padding: 40px;
            animation: welcomeFloat 0.8s ease-out;
        }

        .welcome-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #BFF0EC, #B29647);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            margin-bottom: 40px;
            opacity: 0.9;
            line-height: 1.6;
        }

        .start-btn {
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(135deg, #B29647 0%, #d4b564 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            letter-spacing: 1px;
            box-shadow: 0 15px 35px rgba(178, 150, 71, 0.3);
            position: relative;
            overflow: hidden;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 40px rgba(178, 150, 71, 0.4);
        }

        .start-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(191, 240, 236, 0.6);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }

        .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { left: 20%; animation-delay: 1s; }
        .particle:nth-child(3) { left: 30%; animation-delay: 2s; }
        .particle:nth-child(4) { left: 40%; animation-delay: 3s; }
        .particle:nth-child(5) { left: 50%; animation-delay: 4s; }
        .particle:nth-child(6) { left: 60%; animation-delay: 5s; }
        .particle:nth-child(7) { left: 70%; animation-delay: 0.5s; }
        .particle:nth-child(8) { left: 80%; animation-delay: 1.5s; }
        .particle:nth-child(9) { left: 90%; animation-delay: 2.5s; }

        @keyframes welcomeFloat {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .main-container {
            transition: filter 0.6s ease;
        }

        .main-container.blurred {
            filter: blur(5px);
        }

        @media (max-width: 768px) {
            .main-content,
            .main-content.results-visible {
                grid-template-columns: 1fr;
            }
            
            .search-panel {
                border-right: none;
                border-bottom: 1px solid #a8e6e1;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .candidate-info {
                grid-template-columns: 1fr;
            }

            .welcome-title {
                font-size: 2.5rem;
            }

            .welcome-subtitle {
                font-size: 1.1rem;
            }

            .start-btn {
                padding: 18px 40px;
                font-size: 1.1rem;
            }

            .results-controls {
                flex-wrap: wrap;
                gap: 10px;
            }

            .pagination {
                flex-wrap: wrap;
                gap: 5px;
            }

            .back-arrow {
                left: 15px;
                width: 40px;
                height: 40px;
            }

            .back-arrow svg {
                width: 20px;
                height: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .upload-label {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Overlay -->
    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="floating-particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
        <div class="welcome-content">
            <h1 class="welcome-title">Find Perfect Candidates</h1>
            <p class="welcome-subtitle">Streamline your recruitment process with intelligent candidate search and management</p>
            <button class="start-btn" onclick="startSearching()">Start Searching</button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="container main-container" id="mainContainer">
        <div class="header">
            <div class="back-arrow" onclick="goBackToWelcome()" title="Back to Welcome">
                <svg viewBox="0 0 24 24">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
                </svg>
            </div>
            <h1>PerformAI Search Dashboard</h1>
            <p>Explore the perfect candidates for your clients</p>
        </div>

        <div class="main-content">
            <div class="search-panel">
                <div class="search-panel-loading" id="searchPanelLoading">
                    <div class="loading-content">
                        <div class="spinner"></div>
                        <h4>Processing PDF...</h4>
                        <p>Extracting information from your document</p>
                    </div>
                </div>
                <form id="searchForm">
                    <div class="form-section">
                        <div class="form-section-header">
                            <h3>Search Information</h3>
                            <div>
                                <input type="file" id="pdfUpload" accept=".pdf" style="display: none;">
                                <label for="pdfUpload" class="upload-label" title="Upload search brief PDF">
                                    📎 Upload PDF
                                </label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="client">Client</label>
                                <input type="text" id="client" name="client" placeholder="Company name">
                            </div>
                            <div class="form-group">
                                <label for="title">Job Title</label>
                                <input type="text" id="title" name="title" placeholder="e.g. Senior Developer">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="Seniority">Seniority Level</label>
                                <input type="text" id="seniority" name="seniority" placeholder="e.g. Senior">
                            </div>
                            <div class="form-group">
                                <label for="location">Location</label>
                                <input type="text" id="location" name="location" placeholder="City, State or Remote">
                            </div>
                        </div>
                        <div class="form-section">
                                <label for="companies"> Target Companies</label>
                                <input type="text" id="companies" name="companies" placeholder="e.g. PepsiCo, Coca-Cola">
                            </div>
                    </div>

                    <div class="form-section">
                        <h3>Requirements</h3>
                        <div class="form-group">
                            <label for="mustHave">Must Have Skills</label>
                            <textarea id="mustHave" name="mustHave" placeholder="Required skills, technologies, experience..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="niceToHave">Nice to Have</label>
                            <textarea id="niceToHave" name="niceToHave" placeholder="Preferred skills, bonus qualifications..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Additional Info</h3>
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea id="notes" name="notes" placeholder="Additional notes or comments..."></textarea>
                        </div>
                    </div>

                    <button type="submit" class="search-btn" id="searchBtn">
                        Search Candidates
                    </button>
                </form>
            </div>

            <div class="results-panel">
                <div class="results-header">
                    <h3>Search Results</h3>
                    <div class="results-header-right">
                        <!-- Commented out - Save to Google Sheets button
                        <button class="save-to-sheets-btn" id="saveToSheetsBtn" onclick="saveToGoogleSheets()">
                            Save to Google Sheets
                        </button>
                        -->
                        <div id="googleSheetsWrapper" style="position: relative; display: inline-block;">
                            <span id="spreadsheetBubble" style="
                                display: none;
                                position: absolute;
                                top: -30px;
                                left: 50%;
                                transform: translateX(-50%);
                                background: rgba(203, 240, 191, 0.3);
                                color: #0F9D58;
                                border-radius: 10px;
                                padding: 4px 8px;
                                font-size: 12px;
                                white-space: nowrap;
                                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                                z-index: 999;
                            "></span>
                            <div class="google-sheets-icon" id="googleSheetsIcon" title="Export to Google Sheets" onclick="saveToGoogleSheets()">
                                <img src="Google_Sheets_2020_Logo.png" alt="Google Sheets" />
                            </div>
                        </div>
                        <div class="results-count" id="resultsCount">0 candidates found</div>
                    </div>
                </div>

                <div class="results-controls">
                    <div class="results-per-page">
                        <label>Show:</label>
                        <select id="resultsPerPage" onchange="changeResultsPerPage()">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span>per page</span>
                    </div>
                </div>

                <div class="results-container">
                    <div class="results-grid" id="searchResults">
                        <div class="empty-state">
                            <h4>Ready to find candidates</h4>
                            <p>Fill out the search form and click "Search Candidates" to get started.</p>
                        </div>
                    </div>
                </div>

                <div class="pagination" id="pagination" style="display: none;">
                    <button onclick="goToPage(1)" id="firstPage">First</button>
                    <button onclick="goToPage(currentPage - 1)" id="prevPage">Previous</button>
                    <div class="pagination-info" id="paginationInfo"></div>
                    <button onclick="goToPage(currentPage + 1)" id="nextPage">Next</button>
                    <button onclick="goToPage(totalPages)" id="lastPage">Last</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    let savedCandidates = JSON.parse(localStorage.getItem('savedCandidates') || '[]');
    let allCandidates = [];
    let currentPage = 1;
    let resultsPerPage = 25;
    let totalPages = 1;
    let currentView = 'cards';
    let hasSearchResults = false; // Track if user has run a search

    function startSearching() {
        const overlay = document.getElementById('welcomeOverlay');
        const mainContainer = document.getElementById('mainContainer');
        
        overlay.classList.add('hidden');
        mainContainer.classList.remove('blurred');
    }

    function goBackToWelcome() {
        const overlay = document.getElementById('welcomeOverlay');
        const mainContainer = document.getElementById('mainContainer');
        const mainContent = document.querySelector('.main-content');
        
        // Disable page reload protection when intentionally going back
        hasSearchResults = false;
        
        overlay.classList.remove('hidden');
        mainContainer.classList.add('blurred');
        
        // Reset layout to default
        mainContent.classList.remove('results-visible');
        
        // Clear search results
        const resultsDiv = document.getElementById('searchResults');
        resultsDiv.innerHTML = `
            <div class="empty-state">
                <h4>Ready to find candidates</h4>
                <p>Fill out the search form and click "Search Candidates" to get started.</p>
            </div>
        `;
        
        // Reset results count
        document.getElementById('resultsCount').textContent = '0 candidates found';
        
        // Hide pagination
        document.getElementById('pagination').style.display = 'none';
        
        // Reset search button
        const searchBtn = document.getElementById('searchBtn');
        searchBtn.disabled = false;
        searchBtn.textContent = 'Search Candidates';
        
        // Reset Save to Google Sheets button (commented out)
        // const saveToSheetsBtn = document.getElementById('saveToSheetsBtn');
        // saveToSheetsBtn.disabled = false;
        // saveToSheetsBtn.textContent = 'Save to Google Sheets';
        // saveToSheetsBtn.style.display = 'none';
        
        // Reset Google Sheets icon
        const googleSheetsIcon = document.getElementById('googleSheetsIcon');
        googleSheetsIcon.style.display = 'none';
        
        // Clear form data
        document.getElementById('searchForm').reset();
        
        // Reset candidate data
        allCandidates = [];
        currentPage = 1;
    }

    function showLoading() {
        // Scroll to top of page when loading starts
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });

        // Create overlay if it doesn't exist
        let overlay = document.getElementById('loadingOverlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'loadingOverlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100vw';
            overlay.style.height = '100vh';
            overlay.style.background = 'rgba(255,255,255,0.85)';
            overlay.style.backdropFilter = 'blur(6px)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = '2000';
            overlay.innerHTML = `
                <div class="loading" style="background:rgba(255,255,255,0.95); border-radius:18px; box-shadow:0 8px 32px rgba(0,0,0,0.08); padding:48px 60px;">
                    <div class="spinner"></div>
                    <h4 style="color:#0D313E;">Searching candidates...</h4>
                    <p style="color:#6c757d;">This may take a few moments</p>
                </div>
            `;
            document.body.appendChild(overlay);
        } else {
            overlay.style.display = 'flex';
        }

        // Optionally blur the main container
        const mainContainer = document.getElementById('mainContainer');
        if (mainContainer) mainContainer.classList.add('blurred');

        const searchBtn = document.getElementById('searchBtn');
        searchBtn.disabled = true;
        searchBtn.textContent = 'Searching...';

        document.getElementById('pagination').style.display = 'none';
    }

    function showSearchPanelLoading() {
        const loadingOverlay = document.getElementById('searchPanelLoading');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'flex';
        }
    }

    function hideSearchPanelLoading() {
        const loadingOverlay = document.getElementById('searchPanelLoading');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
        }
    }

    // Remove overlay when done (call this in displayResults and showError)
    function hideLoadingOverlay() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) overlay.style.display = 'none';
        const mainContainer = document.getElementById('mainContainer');
        if (mainContainer) mainContainer.classList.remove('blurred');
    
        
        const searchBtn = document.getElementById('searchBtn');
        searchBtn.disabled = true;
        searchBtn.textContent = 'Searching...';
        
        document.getElementById('pagination').style.display = 'none';

    }

    function showError(message) {
        hideLoadingOverlay();
        
        const resultsDiv = document.getElementById('searchResults');
        const mainContent = document.querySelector('.main-content');
        
        // Reset layout to default on error
        mainContent.classList.remove('results-visible');
        
        resultsDiv.innerHTML = `
            <div class="empty-state">
                <h4>Error</h4>
                <p>${message}</p>
            </div>
        `;
        
        const searchBtn = document.getElementById('searchBtn');
        searchBtn.disabled = false;
        searchBtn.textContent = 'Search Candidates';
        
        document.getElementById('pagination').style.display = 'none';
    }

    async function saveToGoogleSheets() {
        if (allCandidates.length === 0) {
            alert('No candidates to save');
            return;
        }

        const googleSheetsIcon = document.getElementById('googleSheetsIcon');
        const spreadsheetBubble = document.getElementById('spreadsheetBubble');
        const originalTitle = googleSheetsIcon.title;

        googleSheetsIcon.title = 'Saving...';
        googleSheetsIcon.style.opacity = '0.6';
        googleSheetsIcon.style.pointerEvents = 'none';

        const dataToSend = allCandidates.map((candidate, index) => ({
            rank: index + 1,
            name: candidate.name || '',
            title: candidate.job1 || '',
            location: candidate.location || '',
            skills: candidate.skills || '',
            reason: candidate.reason || '',
            recent_role: candidate.job1 || '',
            linkedin_url: candidate.linkedin_url || '',
            search: candidate.search_id || ''
        }));

        try {
            const response = await fetch("https://apl-luth-surface-pro-6.tailf44f15.ts.net/webhook/save-candidates", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dataToSend)
            });

            if (!response.ok) throw new Error("Failed to save");

            const result = await response.json(); // expected: { sheet_url: "https://..." }

            googleSheetsIcon.title = 'Saved ✓';
            googleSheetsIcon.style.opacity = '1';
            googleSheetsIcon.style.pointerEvents = 'none';
            googleSheetsIcon.style.filter = 'grayscale(1) brightness(0.8)';

            if (result.spreadsheetUrl) {
                spreadsheetBubble.innerHTML = `
                    <a href="${result.spreadsheetUrl}" target="_blank" style="
                        color: #0F9D58;
                        text-decoration: none;
                        font-weight: 600;
                    ">📄 View Sheet</a>
                `;
                spreadsheetBubble.style.display = 'inline-block';
            }

        } catch (err) {
            console.error(err);
            alert("❌ Error saving to Google Sheets.");
            googleSheetsIcon.title = originalTitle;
            googleSheetsIcon.style.opacity = '1';
            googleSheetsIcon.style.pointerEvents = 'auto';
        }
    }

    function displayResults() {
        hideLoadingOverlay();
        const resultsDiv = document.getElementById('searchResults');
        const resultsCount = document.getElementById('resultsCount');
        const searchBtn = document.getElementById('searchBtn');
        const paginationDiv = document.getElementById('pagination');
        const mainContent = document.querySelector('.main-content');
        // const saveToSheetsBtn = document.getElementById('saveToSheetsBtn'); // Commented out
        const googleSheetsIcon = document.getElementById('googleSheetsIcon');
        
        searchBtn.disabled = false;
        searchBtn.textContent = 'Search Candidates';

        totalPages = Math.ceil(allCandidates.length / resultsPerPage);
        const startIndex = (currentPage - 1) * resultsPerPage;
        const endIndex = startIndex + resultsPerPage;
        const currentCandidates = allCandidates.slice(startIndex, endIndex);
        
        resultsCount.textContent = `${allCandidates.length} candidates found`;

        if (allCandidates.length === 0) {
            resultsDiv.innerHTML = `
                <div class="empty-state">
                    <h4>No candidates found</h4>
                    <p>Try adjusting your search criteria</p>
                </div>
            `;
            paginationDiv.style.display = 'none';
            mainContent.classList.remove('results-visible');
            // saveToSheetsBtn.style.display = 'none'; // Commented out - Hide button when no results
            googleSheetsIcon.style.display = 'none'; // Hide icon when no results
            return;
        }

        // Show Google Sheets icon when results are displayed
        // saveToSheetsBtn.style.display = 'flex'; // Commented out
        googleSheetsIcon.style.display = 'flex';
        
        // Expand results panel when candidates are found
        mainContent.classList.add('results-visible');

        resultsDiv.innerHTML = currentCandidates.map((candidate, index) => {
            const rank = (currentPage - 1) * resultsPerPage + index + 1;
            return `
                <div class="candidate-card ${currentView === 'compact' ? 'compact' : ''}">
                    <div class="candidate-header">
                        <div>
                            <div class="candidate-name">
                                ${candidate.name}
                                <img 
                                    src="LinkedIn_logo_initials.png" 
                                    alt="LinkedIn" 
                                    class="linkedin-icon" 
                                    title="View LinkedIn Profile" 
                                    style="width:20px; height:20px; cursor:pointer; margin-left:10px; vertical-align:middle; margin-bottom:4px;"
                                    onclick="viewCandidate('${encodeURIComponent(candidate.linkedin_url || '')}')"
                                />
                            </div>
                            <div class="candidate-title">${candidate.job1 || ''}</div>
                        </div>
                        <div class="candidate-rank">${candidate.score}/10</div>
                    </div>
                    <div class="candidate-info">
                        ${candidate.location ? `
                            <div class="info-item">
                                <span class="info-label">Location:</span>
                                <span class="info-value">${cleanLocation(candidate.location)}</span>
                            </div>
                        ` : ''}
                        ${candidate.skills ? `
                            <div class="info-item skills-container">
                                <span class="info-label">Skills:</span>
                                <div class="skills-list">
                                    ${candidate.skills.split(',').slice(0, 4).map(skill => `
                                        <span class="skill-pill">${skill.trim()}</span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    ${candidate.reason ? `
                        <button class="learn-more-btn" onclick="toggleCandidateReason(${rank})">
                            Learn More <span class="arrow">▼</span>
                        </button>
                        <div class="candidate-reason" id="reason-${rank}">
                            <h5>Why this candidate is a good match:</h5>
                            <p>${candidate.reason}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }).join('');


        paginationDiv.style.display = totalPages > 1 ? 'flex' : 'none';
        if (totalPages > 1) updatePagination();
    }


    function updatePagination() {
        const paginationInfo = document.getElementById('paginationInfo');
        const firstPage = document.getElementById('firstPage');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const lastPage = document.getElementById('lastPage');
        
        const startItem = (currentPage - 1) * resultsPerPage + 1;
        const endItem = Math.min(currentPage * resultsPerPage, allCandidates.length);
        paginationInfo.textContent = `${startItem}-${endItem} of ${allCandidates.length}`;
        
        firstPage.disabled = currentPage === 1;
        prevPage.disabled = currentPage === 1;
        nextPage.disabled = currentPage === totalPages;
        lastPage.disabled = currentPage === totalPages;
    }

function goToPage(page) {
    if (page >= 1 && page <= totalPages && page !== currentPage) {
        currentPage = page;
        displayResults();
        // Scroll the results panel to the top
        const resultsPanel = document.querySelector('.results-panel');
        if (resultsPanel) {
            resultsPanel.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
}

    function changeResultsPerPage() {
        resultsPerPage = parseInt(document.getElementById('resultsPerPage').value);
        currentPage = 1;
        displayResults();
    }

    function changeView(view) {
        currentView = view;
        document.querySelectorAll('.view-toggle button').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        document.getElementById('searchResults').className = `results-grid ${view}`;
        if (allCandidates.length > 0) displayResults();
    }

    function saveCandidate(id) {
        if (!savedCandidates.includes(id)) {
            savedCandidates.push(id);
            localStorage.setItem('savedCandidates', JSON.stringify(savedCandidates));

            const button = event.target;
            button.textContent = 'Saved ✓';
            button.disabled = true;

            alert('Candidate saved successfully!');
        }
    }


    function viewCandidate(encodedUrl) {
        const url = decodeURIComponent(encodedUrl);
        if (url) {
            window.open(url, '_blank');
        } else {
            alert("No LinkedIn profile found for this candidate.");
        }
    }

    function cleanLocation(location) {
        if (!location) return '';
        
        // Remove "United States" from the end of location strings
        return location
            .replace(/,?\s*United States$/i, '')
            .replace(/,?\s*USA$/i, '')
            .replace(/,?\s*US$/i, '')
            .trim();
    }

    function toggleCandidateReason(rank) {
        const reasonDiv = document.getElementById(`reason-${rank}`);
        const button = event.target;
        const arrow = button.querySelector('.arrow');
        
        if (reasonDiv.classList.contains('visible')) {
            // Close the reason section
            reasonDiv.classList.remove('visible');
            button.classList.remove('expanded');
            button.innerHTML = 'Learn More <span class="arrow">▼</span>';
        } else {
            // Open the reason section
            reasonDiv.classList.add('visible');
            button.classList.add('expanded');
            button.innerHTML = 'Show Less <span class="arrow">▼</span>';
        }
    }



    document.getElementById('pdfUpload').addEventListener('change', async function (e) {
        const file = e.target.files[0];
        if (!file || file.type !== "application/pdf") {
            alert("Please upload a valid PDF file.");
            return;
        }

        showSearchPanelLoading();

        try {
            const formData = new FormData();
            formData.append("pdf", file);

            const response = await fetch("https://apl-luth-surface-pro-6.tailf44f15.ts.net/webhook/pdf-parse-webhook", {
                method: "POST",
                body: formData
            });

            if (!response.ok) {
                alert("Failed to extract data from PDF.");
                hideSearchPanelLoading();
                return;
            }

            const parsedFields = await response.json();
            const data = parsedFields[0];  // Get the first (and only) object in the array

            // Fill form fields
            document.querySelector('[name="client"]').value = data.client_name || "";
            document.querySelector('[name="title"]').value = data.job_title || "";
            document.querySelector('[name="seniority"]').value = data.seniority || "";
            document.querySelector('[name="companies"]').value = (data.target_companies || []).join(', ');
            document.querySelector('[name="location"]').value = data.location || "";
            document.querySelector('[name="mustHave"]').value = (data.must_have_criteria || []).join('\n');
            document.querySelector('[name="niceToHave"]').value = (data.nice_to_have_criteria || []).join('\n');
            document.querySelector('[name="notes"]').value = data.notes || "";
            if (document.querySelector('[name="recruiter"]')) {
                document.querySelector('[name="recruiter"]').value = data.recruiter || "";
            }

            hideSearchPanelLoading();

        } catch (error) {
            console.error('PDF processing error:', error);
            alert("An error occurred while processing the PDF.");
            hideSearchPanelLoading();
        }
    });



    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('mainContainer').classList.add('blurred');
        console.log(`${savedCandidates.length} candidates previously saved`);
        
        // Add beforeunload protection when user has search results
        window.addEventListener('beforeunload', function (e) {
            if (hasSearchResults && allCandidates.length > 0) {
                const confirmationMessage = 'You have unsaved search results. Are you sure you want to leave? This will lose your current search and you\'ll need to run the expensive API search again.';
                e.preventDefault();
                e.returnValue = confirmationMessage; // For older browsers
                return confirmationMessage;
            }
        });
        
        document.getElementById('searchForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const searchData = Object.fromEntries(formData.entries());
            showLoading();

            try {
                const response = await fetch('https://apl-luth-surface-pro-6.tailf44f15.ts.net/webhook/search-candidates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(searchData)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("Webhook failed:", errorText);
                    showError('Candidate search failed. Try again.');
                    return;
                }

                const candidates = await response.json();
                allCandidates = candidates;
                currentPage = 1;
                hasSearchResults = true; // Enable page reload protection
                displayResults();

            } catch (error) {
                console.error('Search error:', error);
                showError('Failed to search candidates. Please try again.');
            }
        });
    });
</script>
